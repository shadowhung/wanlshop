(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-user-portrait-portrait"],{1228:function(t,e,i){"use strict";var a=i("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=a(i("5530")),h=i("2f62"),s={data:function(){return{url:"",path:"",usermaks:""}},computed:(0,o.default)({},(0,h.mapState)(["user"])),methods:{chooseImage:function(){var t=this;uni.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:function(e){t.url=e.tempFilePaths[0]}}),this.usermaks=this.$wanlshop.maks()},getCropperImage:function(t){var e=this;this.path=t.path,this.url="",this.$api.get({url:"/wanlshop/common/uploadData",success:function(i){e.$api.upload({url:i.uploadurl,filePath:t.path,name:"file",formData:"local"==i.storage?null:i.multipart,success:function(t){e.$api.post({url:"/wanlshop/user/profile",data:{avatar:t.fullurl},success:function(t){e.$store.commit("user/setUserInfo",{avatar:t.avatar})}})}})}})},oncancle:function(){this.url=""}}};e.default=s},"1cb2":function(t,e,i){var a=i("99ab");"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var o=i("4f06").default;o("ad4a1b8a",a,!0,{sourceMap:!1,shadowMode:!1})},"1d12":function(t,e,i){"use strict";var a=i("1cb2"),o=i.n(a);o.a},"29d4":function(t,e,i){"use strict";i.r(e);var a=i("9253"),o=i.n(a);for(var h in a)"default"!==h&&function(t){i.d(e,t,(function(){return a[t]}))}(h);e["default"]=o.a},"4aa2":function(t,e,i){var a=i("24fb");e=a(!1),e.push([t.i,".avatar[data-v-22829a20]{width:5rem;height:5rem;background-color:#e5e5e5;border-radius:50%;margin:%?30?%}",""]),t.exports=e},"4edc":function(t,e,i){var a=i("4aa2");"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var o=i("4f06").default;o("4cc74cc2",a,!0,{sourceMap:!1,shadowMode:!1})},8431:function(t,e,i){"use strict";i.r(e);var a=i("1228"),o=i.n(a);for(var h in a)"default"!==h&&function(t){i.d(e,t,(function(){return a[t]}))}(h);e["default"]=o.a},9253:function(t,e,i){"use strict";(function(t){i("ace4"),i("a9e3"),i("d3b7"),i("ac1f"),i("3ca3"),i("466d"),i("1276"),i("5cc6"),i("9a8c"),i("a975"),i("735e"),i("c1ac"),i("d139"),i("3a7b"),i("d5d6"),i("82f8"),i("e91f"),i("60bd"),i("5f96"),i("3280"),i("3fcc"),i("ca91"),i("25a1"),i("cd26"),i("3c5d"),i("2954"),i("649e"),i("219c"),i("170b"),i("b39a"),i("72f7"),i("ddb0"),i("2b3d"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a={props:{url:{type:String,default:""},fixed:{type:Boolean,default:!1},width:{type:Number,default:200},height:{type:Number,default:200},maxWidth:{type:Number,default:1024},maxHeight:{type:Number,default:1024},blob:{type:Boolean,default:!0}},data:function(){return{mask:{show:!1},frame:{left:50,top:50,width:this.width,height:this.height},image:{left:20,top:20,width:300,height:400},real:{width:100,height:100},target:{width:this.width,height:this.height},touches:[],type:"",start:{frame:{left:0,top:0,width:0,height:0},image:{left:0,top:0,width:0,height:0}},timeoutId:-1,context:null}},mounted:function(){this.$el.addEventListener("touchmove",(function(t){t.preventDefault()})),this.context=uni.createCanvasContext("canvas",this),this.targetContext=uni.createCanvasContext("target",this)},methods:{imageLoad:function(t){var e=this;this.mask.show=!0,this.real.width=t.detail.width,this.real.height=t.detail.height,this.image.width=t.detail.width,this.image.height=t.detail.height,this.frame.width=this.width,this.frame.height=this.height,this.fixed||(this.frame.width=this.image.width,this.frame.height=this.image.height);var i=uni.createSelectorQuery().in(this);i.select(".body").boundingClientRect((function(t){var i=t.width,a=t.height,o=e.frame.width,h=e.frame.height,s=.8*i,n=.8*a,r=s/o,l=n/h,c=r;r<l&&(c=l),s=o*c,n=h*c;var f=(i-s)/2,u=(a-n)/2;e.frame.width=s,e.frame.height=n,e.frame.left=f,e.frame.top=u;var d=e.image.width,m=e.image.height;r=s/d,l=n/m,c=r,r<l&&(c=l),e.image.width=d*c,e.image.height=m*c,e.image.left=(i-e.image.width)/2,e.image.top=(a-e.image.height)/2,setTimeout((function(){e.trimImage()}),100)})).exec()},touchHandle:function(){},touchStart:function(t,e){this.stopTime(),this.mask.show=!1,0==this.touches.length&&(this.type=e,this.start.frame.left=this.frame.left,this.start.frame.top=this.frame.top,this.start.frame.width=this.frame.width,this.start.frame.height=this.frame.height,this.start.image.left=this.image.left,this.start.image.top=this.image.top,this.start.image.width=this.image.width,this.start.image.height=this.image.height);for(var i=t.changedTouches,a=0;a<i.length;a++){var o=i[a];this.touches.push(o)}},touchMove:function(t){this.stopTime(),t.preventDefault();var e=t.touches;if(1==this.touches.length)"plank"==this.type||"frame"==this.type||this.fixed?this.moveImage(this.touches[0],e[0]):this.scaleFrame(this.touches[0],e[0],this.type);else if(2==this.touches.length&&2==e.length){var i=this.touches[0],a=this.touches[1],o=e[0],h=e[1];if(i.identifier!=o.identifier){var s=o;o=h,h=s}this.scaleImage(i,a,o,h)}},touchEnd:function(t){this.type="",this.touches=[],this.startTime()},touchCancel:function(t){this.type="",this.touches=[],this.startTime()},startTime:function(){var t=this;this.stopTime(),this.timeoutId=setTimeout((function(){t.trimImage()}),800)},stopTime:function(){this.timeoutId>=0&&(clearTimeout(this.timeoutId),this.timeoutId=-1)},trimImage:function(){var t=this;this.mask.show=!0;var e=uni.createSelectorQuery().in(this);e.select(".body").boundingClientRect((function(e){var i=e.width,a=e.height,o=t.frame.width,h=t.frame.height,s=.8*i,n=.8*a,r=s/o,l=n/h,c=r;r>l&&(c=l),s=o*c,n=h*c;var f=(i-s)/2,u=(a-n)/2,d=f-t.frame.left+(t.frame.left-t.image.left)*(1-c),m=u-t.frame.top+(t.frame.top-t.image.top)*(1-c);t.frame.width=s,t.frame.height=n,t.frame.left=f,t.frame.top=u,t.image.width*=c,t.image.height*=c,t.image.left+=d,t.image.top+=m})).exec(),setTimeout((function(){var e=t.image.width/t.real.width,i=(t.frame.left-t.image.left)/e,a=(t.frame.top-t.image.top)/e,o=t.frame.width/e,h=t.frame.height/e;t.context.drawImage(t.url,i,a,o,h,0,0,t.frame.width,t.frame.height),t.context.draw(!1)}),100)},moveImage:function(t,e){var i=e.clientX-t.clientX,a=e.clientY-t.clientY;this.image.left=this.start.image.left+i,this.image.top=this.start.image.top+a,this.image.left>this.frame.left&&(this.image.left=this.frame.left),this.image.top>this.frame.top&&(this.image.top=this.frame.top),this.image.left+this.image.width<this.frame.left+this.frame.width&&(this.image.left=this.frame.left+this.frame.width-this.image.width),this.image.top+this.image.height<this.frame.top+this.frame.height&&(this.image.top=this.frame.top+this.frame.height-this.image.height)},scaleImage:function(t,e,i,a){var o=t.clientX,h=t.clientY,s=e.clientX,n=e.clientY,r=i.clientX,l=i.clientY,c=a.clientX,f=a.clientY,u=Math.sqrt((o-s)*(o-s)+(h-n)*(h-n)),d=Math.sqrt((r-c)*(r-c)+(l-f)*(l-f)),m=(o+s)/2,p=(h+n)/2,g=(r+c)/2,v=(l+f)/2,w=g-m,b=v-p,x=d/u;this.start.image.width*x<this.frame.width&&(x=this.frame.width/this.start.image.width),this.start.image.height*x<this.frame.height&&(x=this.frame.height/this.start.image.height),this.start.image.width*x<this.frame.width&&(x=this.frame.width/this.start.image.width),this.image.left=this.start.image.left+w-(m-this.start.image.left)*(x-1),this.image.top=this.start.image.top+b-(p-this.start.image.top)*(x-1),this.image.width=this.start.image.width*x,this.image.height=this.start.image.height*x,this.image.left>this.frame.left&&(this.image.left=this.frame.left),this.image.top>this.frame.top&&(this.image.top=this.frame.top),this.image.left+this.image.width<this.frame.left+this.frame.width&&(this.image.left=this.frame.left+this.frame.width-this.image.width),this.image.top+this.image.height<this.frame.top+this.frame.height&&(this.image.top=this.frame.top+this.frame.height-this.image.height)},scaleFrame:function(t,e,i){var a=e.clientX-t.clientX,o=e.clientY-t.clientY,h=this.start.frame.left,s=this.start.frame.top,n=this.start.frame.left+this.start.frame.width,r=this.start.frame.top+this.start.frame.height;"left"==i?h+=a:"right"==i?n+=a:"top"==i?s+=o:"bottom"==i?r+=o:"left-top"==i?(h+=a,s+=o):"left-bottom"==i?(h+=a,r+=o):"right-top"==i?(n+=a,s+=o):"right-bottom"==i&&(n+=a,r+=o),h<this.image.left&&(h=this.image.left),s<this.image.top&&(s=this.image.top),n>this.image.left+this.image.width&&(n=this.image.left+this.image.width),r>this.image.top+this.image.height&&(r=this.image.top+this.image.height),this.frame.left=h,this.frame.top=s,this.frame.width=n-h,this.frame.height=r-s},parseBlob:function(t){for(var e=t.split(","),i=e[0].match(/:(.*?);/)[1],a=atob(e[1]),o=a.length,h=new Uint8Array(o),s=0;s<o;s++)h[s]=a.charCodeAt(s);var n=URL||webkitURL;return n.createObjectURL(new Blob([h],{type:i}))},onok:function(){var e=this,i=this.image.width/this.real.width,a=(this.frame.left-this.image.left)/i,o=(this.frame.top-this.image.top)/i,h=this.frame.width/i,s=this.frame.height/i,n=h,r=s;if(this.fixed)n=this.width/2,r=this.height/2;else{if(n>this.maxWidth/2){var l=this.maxWidth/2/n;n*=l,r*=l}if(r>this.maxHeight/2){l=this.maxHeight/2/r;r*=l,n*=l}}this.target.width=n,this.target.height=r,uni.showLoading({title:"正在裁剪"}),setTimeout((function(){e.targetContext.drawImage(e.url,a,o,h,s,0,0,n,r),e.targetContext.draw(!1,(function(){uni.canvasToTempFilePath({canvasId:"target",success:function(t){var i=t.tempFilePath;e.blob&&(i=e.parseBlob(i)),e.$emit("ok",{path:i})},fail:function(e){t.log(e)},complete:function(){uni.hideLoading()}},e)}))}),100)},oncancle:function(){this.$emit("cancel")}}};e.default=a}).call(this,i("5a52")["default"])},"99ab":function(t,e,i){var a=i("24fb");e=a(!1),e.push([t.i,".wanl-image-cutter[data-v-1647750c]{position:absolute;width:100%;height:100%;top:0;bottom:0;z-index:1000}.toolbar[data-v-1647750c]{position:absolute;width:100%;height:%?100?%;left:%?0?%;bottom:%?0?%;box-sizing:border-box;border-bottom:1px solid silver;background:#f8f8f8}.btn-cancel[data-v-1647750c]{position:absolute;left:%?100?%;top:%?12?%;font-size:%?30?%;line-height:%?30?%;padding:%?20?%;color:#333}.btn-ok[data-v-1647750c]{position:absolute;right:%?100?%;top:%?12?%;font-size:%?30?%;line-height:%?30?%;padding:%?20?%;color:#333}.body[data-v-1647750c]{position:absolute;left:%?0?%;right:%?0?%;top:%?0?%;bottom:%?100?%;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAAA3NCSVQICAjb4U/gAAAABlBMVEXMzMz////TjRV2AAAACXBIWXMAAArrAAAK6wGCiw1aAAAAHHRFWHRTb2Z0d2FyZQBBZG9iZSBGaXJld29ya3MgQ1M26LyyjAAAABFJREFUCJlj+M/AgBVhF/0PAH6/D/HkDxOGAAAAAElFTkSuQmCC);overflow:hidden}uni-button[data-v-1647750c]:after{border:0}.mask[data-v-1647750c]{position:absolute;left:%?0?%;right:%?0?%;top:%?0?%;bottom:%?0?%;background:#000;opacity:.6}.plank[data-v-1647750c]{position:absolute;left:%?0?%;right:%?0?%;top:%?0?%;bottom:%?0?%}.image[data-v-1647750c]{position:absolute}.frame[data-v-1647750c]{position:absolute}.canvas[data-v-1647750c]{position:absolute;display:block;left:0;top:0}.rect[data-v-1647750c]{position:absolute;left:-2px;top:-2px;width:100%;height:100%;border:2px solid #fff}.line-one[data-v-1647750c]{position:absolute;width:100%;height:1px;background:#fff;left:0;top:33.3%}.line-two[data-v-1647750c]{position:absolute;width:100%;height:1px;background:#fff;left:0;top:66.7%}.line-three[data-v-1647750c]{position:absolute;width:1px;height:100%;background:#fff;top:0;left:33.3%}.line-four[data-v-1647750c]{position:absolute;width:1px;height:100%;background:#fff;top:0;left:66.7%}.frame-left[data-v-1647750c]{position:absolute;height:100%;width:8px;left:-4px;top:0}.frame-right[data-v-1647750c]{position:absolute;height:100%;width:8px;right:-4px;top:0}.frame-top[data-v-1647750c]{position:absolute;width:100%;height:8px;top:-4px;left:0}.frame-bottom[data-v-1647750c]{position:absolute;width:100%;height:8px;bottom:-4px;left:0}.frame-left-top[data-v-1647750c]{position:absolute;width:20px;height:20px;left:-6px;top:-6px;border-left:4px solid red;border-top:4px solid red}.frame-left-bottom[data-v-1647750c]{position:absolute;width:20px;height:20px;left:-6px;bottom:-6px;border-left:4px solid red;border-bottom:4px solid red}.frame-right-top[data-v-1647750c]{position:absolute;width:20px;height:20px;right:-6px;top:-6px;border-right:4px solid red;border-top:4px solid red}.frame-right-bottom[data-v-1647750c]{position:absolute;width:20px;height:20px;right:-6px;bottom:-6px;border-right:4px solid red;border-bottom:4px solid red}",""]),t.exports=e},"9aeb":function(t,e,i){"use strict";var a=i("4edc"),o=i.n(a);o.a},d18c:function(t,e,i){"use strict";var a;i.d(e,"b",(function(){return o})),i.d(e,"c",(function(){return h})),i.d(e,"a",(function(){return a}));var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:t.url,expression:"url"}],staticClass:"wanl-image-cutter"},[i("v-uni-canvas",{style:{width:t.target.width+"px",height:t.target.height+"px"},attrs:{"canvas-id":"target"}}),i("v-uni-view",{staticClass:"body"},[t.url?i("v-uni-image",{staticClass:"image",style:{left:t.image.left+"px",top:t.image.top+"px",width:t.image.width+"px",height:t.image.height+"px"},attrs:{src:t.url},on:{load:function(e){arguments[0]=e=t.$handleEvent(e),t.imageLoad.apply(void 0,arguments)}}}):t._e(),t.mask.show?i("v-uni-view",{staticClass:"mask"}):t._e(),i("v-uni-view",{staticClass:"plank",on:{touchstart:function(e){arguments[0]=e=t.$handleEvent(e),t.touchStart(e,"plank")},touchmove:function(e){arguments[0]=e=t.$handleEvent(e),t.touchMove.apply(void 0,arguments)},touchend:function(e){arguments[0]=e=t.$handleEvent(e),t.touchEnd.apply(void 0,arguments)},touchcancel:function(e){arguments[0]=e=t.$handleEvent(e),t.touchCancel.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"frame",style:{left:t.frame.left+"px",top:t.frame.top+"px",width:t.frame.width+"px",height:t.frame.height+"px"},on:{touchstart:[function(e){arguments[0]=e=t.$handleEvent(e),t.touchStart(e,"frame")},function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.touchHandle.apply(void 0,arguments)}]}},[t.mask.show?i("v-uni-canvas",{staticClass:"canvas",style:{width:t.frame.width+"px",height:t.frame.height+"px"},attrs:{"canvas-id":"canvas"}}):t._e(),i("v-uni-view",{staticClass:"rect"}),i("v-uni-view",{staticClass:"line-one"}),i("v-uni-view",{staticClass:"line-two"}),i("v-uni-view",{staticClass:"line-three"}),i("v-uni-view",{staticClass:"line-four"}),i("v-uni-view",{staticClass:"frame-left",on:{touchstart:[function(e){arguments[0]=e=t.$handleEvent(e),t.touchStart(e,"left")},function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.touchHandle.apply(void 0,arguments)}]}}),i("v-uni-view",{staticClass:"frame-right",on:{touchstart:[function(e){arguments[0]=e=t.$handleEvent(e),t.touchStart(e,"right")},function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.touchHandle.apply(void 0,arguments)}]}}),i("v-uni-view",{staticClass:"frame-top",on:{touchstart:[function(e){arguments[0]=e=t.$handleEvent(e),t.touchStart(e,"top")},function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.touchHandle.apply(void 0,arguments)}]}}),i("v-uni-view",{staticClass:"frame-bottom",on:{touchstart:[function(e){arguments[0]=e=t.$handleEvent(e),t.touchStart(e,"bottom")},function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.touchHandle.apply(void 0,arguments)}]}}),i("v-uni-view",{staticClass:"frame-left-top",on:{touchstart:[function(e){arguments[0]=e=t.$handleEvent(e),t.touchStart(e,"left-top")},function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.touchHandle.apply(void 0,arguments)}]}}),i("v-uni-view",{staticClass:"frame-left-bottom",on:{touchstart:[function(e){arguments[0]=e=t.$handleEvent(e),t.touchStart(e,"left-bottom")},function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.touchHandle.apply(void 0,arguments)}]}}),i("v-uni-view",{staticClass:"frame-right-top",on:{touchstart:[function(e){arguments[0]=e=t.$handleEvent(e),t.touchStart(e,"right-top")},function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.touchHandle.apply(void 0,arguments)}]}}),i("v-uni-view",{staticClass:"frame-right-bottom",on:{touchstart:[function(e){arguments[0]=e=t.$handleEvent(e),t.touchStart(e,"right-bottom")},function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.touchHandle.apply(void 0,arguments)}]}})],1)],1)],1),i("v-uni-view",{staticClass:"toolbar"},[i("v-uni-button",{staticClass:"btn-cancel",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.oncancle.apply(void 0,arguments)}}},[t._v("返回")]),i("v-uni-button",{staticClass:"btn-ok",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.onok.apply(void 0,arguments)}}},[t._v("決定する")])],1)],1)},h=[]},d434:function(t,e,i){"use strict";i.r(e);var a=i("d18c"),o=i("29d4");for(var h in o)"default"!==h&&function(t){i.d(e,t,(function(){return o[t]}))}(h);i("1d12");var s,n=i("f0c5"),r=Object(n["a"])(o["default"],a["b"],a["c"],!1,null,"1647750c",null,!1,a["a"],s);e["default"]=r.exports},d496:function(t,e,i){"use strict";i.d(e,"b",(function(){return o})),i.d(e,"c",(function(){return h})),i.d(e,"a",(function(){return a}));var a={wanlImageCutter:i("d434").default},o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{staticClass:"content"},[i("v-uni-view",{staticClass:"edgeInsetTop"}),i("wanl-image-cutter",{attrs:{url:t.url,fixed:!1,blob:!1,maxWidth:500,maxHeight:500},on:{ok:function(e){arguments[0]=e=t.$handleEvent(e),t.getCropperImage.apply(void 0,arguments)},cancel:function(e){arguments[0]=e=t.$handleEvent(e),t.oncancle.apply(void 0,arguments)}}}),i("v-uni-view",{staticClass:"text-center padding-top-xl",style:{backgroundImage:"url("+t.usermaks+")"}},[t.path?i("v-uni-view",{staticClass:"cu-avatar avatar",style:{backgroundImage:"url("+t.path+")"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.chooseImage.apply(void 0,arguments)}}}):i("v-uni-view",{staticClass:"cu-avatar avatar",style:{backgroundImage:"url("+t.$wanlshop.oss(t.user.avatar,100,100)+")"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.chooseImage.apply(void 0,arguments)}}}),i("v-uni-view",{staticClass:" text-sm",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.chooseImage.apply(void 0,arguments)}}},[t._v("クリックしてアバターを変更します")])],1)],1)},h=[]},e79e:function(t,e,i){"use strict";i.r(e);var a=i("d496"),o=i("8431");for(var h in o)"default"!==h&&function(t){i.d(e,t,(function(){return o[t]}))}(h);i("9aeb");var s,n=i("f0c5"),r=Object(n["a"])(o["default"],a["b"],a["c"],!1,null,"22829a20",null,!1,a["a"],s);e["default"]=r.exports}}]);