(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-shop-live-live"],{"422c":function(t,e,i){"use strict";i.r(e);var o=i("da79"),n=i("7888");for(var a in n)"default"!==a&&function(t){i.d(e,t,(function(){return n[t]}))}(a);i("b3f6");var r,s=i("f0c5"),c=Object(s["a"])(n["default"],o["b"],o["c"],!1,null,"382e2c14",null,!1,o["a"],r);e["default"]=c.exports},"5c80":function(t,e,i){var o=i("95ab");"string"===typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);var n=i("4f06").default;n("08ce111a",o,!0,{sourceMap:!1,shadowMode:!1})},"63c3":function(t,e,i){"use strict";(function(t){var o=i("4ea4");i("4160"),i("159b"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i("96cf");var n=o(i("1da1")),a=o(i("0696")),r=o(i("6399")),s=uni.getSystemInfoSync(),c={components:{wanlLiveHeader:a.default,wanlLiveComment:r.default},data:function(){return{statusBarHeight:s.safeAreaInsets.top,statusFootHeight:s.safeAreaInsets.bottom,screenHeight:s.screenHeight+"px",screenWidth:s.screenWidth+"px",state:0,publish:!0,startTimer:null,liveReady:{content:"哇~直播間上新啦！",image:"",goods_ids:""},liveStatis:{online:0,like:0},liveData:{id:0,liveid:""},shopData:{},goodsData:[],goodsSelected:[]}},onUnload:function(){this.publish=!1,this.pageUnload()},onBackPress:function(){var t=this;this.publish=!1,0==this.liveData.id?this.$wanlshop.back(1):uni.showModal({title:"提示",content:"您确定要结束直播吗？",success:function(e){e.confirm&&(t.stop(),uni.reLaunch({url:"/pages/page/end_live?id=".concat(t.liveData.id)}))}})},onReady:function(){var t=this;this.loadData(),setTimeout((function(){t.context=uni.createLivePusherContext("livePusher",t),t.context.startPreview()}),100),uni.$on("onLive",this.onSocketLive)},methods:{loadData:function(){var t=this;return(0,n.default)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:uni.request({url:"".concat(t.$store.state.common.appUrl.api,"/wanlshop/live/live"),header:{token:t.$store.state.user.token},success:function(e){1==e.data.code?t.shopData=e.data.data:401==e.data.code?uni.navigateTo({url:"/pages/user/auth/auth"}):uni.showToast({title:e.data.msg,icon:"none"})}});case 1:case"end":return e.stop()}}),e)})))()},onSocketLive:function(t){var e=this;if(this.liveData.liveid==t.group){if("publish"==t.message.type)uni.hideLoading(),clearTimeout(this.startTimer);else if("publish_done"==t.message.type){if(this.publish)var i=setInterval((function(){e.$wanlshop.msg("網络状态不佳"),e.context.resume({success:function(t){clearInterval(i)}})}),1500)}else t.message.type;this.liveStatis.like=t.like,this.liveStatis.online=t.online}},pageUnload:function(){1==this.state&&uni.request({url:"".concat(this.$store.state.common.appUrl.api,"/wanlshop/live/unload"),data:{group:this.liveData.liveid,type:"rtmp"},header:{token:this.$store.state.user.token}})},upGoodsList:function(){var t=this;return(0,n.default)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:0==t.goodsData.length&&uni.request({url:"".concat(t.$store.state.common.appUrl.api,"/wanlshop/live/goods"),header:{token:t.$store.state.user.token},success:function(e){t.goodsData=e.data.data}}),t.$refs.listPopup.open();case 2:case"end":return e.stop()}}),e)})))()},upGoods:function(){this.$refs.goodsPopup.open()},chooseImg:function(){var t=this;return(0,n.default)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:uni.chooseImage({sourceType:["camera","album"],sizeType:"compressed",count:1,success:function(e){var i=t.$store.state.user.token;uni.request({url:t.$store.state.common.appUrl.api+"/wanlshop/common/uploadData",header:{token:i},success:function(o){uni.uploadFile({url:o.data.data.uploadurl,filePath:e.tempFilePaths[0],formData:o.data.data.multipart,header:{token:i},name:"file",success:function(e){t.liveReady.image=JSON.parse(e.data).data.fullurl}})}})}});case 1:case"end":return e.stop()}}),e)})))()},stcOss:function(t){var e=this.$store.state.common.appUrl.oss,i="";return i=t?/^(http|https):\/\/.+/.test(t)?t:e+t:e+"/assets/addons/wanlshop/img/common/img_default3x.png",i},addGoods:function(t){this.goodsData[t].choose=!this.goodsData[t].choose,this.formatGoods()},delGoods:function(t){this.goodsData.forEach((function(e,i,o){e.id==t&&(e.choose=!1)})),this.formatGoods()},formatGoods:function(){var t=[],e=[];this.goodsData.forEach((function(i,o,n){i.choose&&(t.push(i),e.push(i.id))})),this.goodsSelected=t,this.liveReady.goods_ids=e},cloud:function(){var t=this;return(0,n.default)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(0!=t.state){e.next=3;break}return uni.showToast({title:"首次不需要同步，点击直播即可",icon:"none"}),e.abrupt("return",!1);case 3:if(0!=t.goodsSelected.length){e.next=7;break}return uni.showToast({title:"商品至少选一個",icon:"none"}),t.upGoodsList(),e.abrupt("return",!1);case 7:uni.showModal({title:"同步商品列表",content:"將把右侧选择的商品同步到直播間",success:function(e){e.confirm&&uni.request({url:"".concat(t.$store.state.common.appUrl.api,"/wanlshop/live/cloud"),data:{id:t.liveData.id,goods_ids:t.liveReady.goods_ids},header:{token:t.$store.state.user.token},success:function(t){1!=t.data.code&&uni.showToast({title:t.data.msg,icon:"none"})}})}});case 8:case"end":return e.stop()}}),e)})))()},startLive:function(){var t=this;return(0,n.default)(regeneratorRuntime.mark((function e(){var i,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:i=t.liveReady.image,o=t.liveReady.content,t.goodsSelected.length<2?(uni.showToast({title:"直播商品至少2件",icon:"none"}),t.upGoodsList()):i?o?(uni.showLoading({title:"直播啟動中"}),t.startTimer=setTimeout((function(){uni.hideLoading(),t.stop(),t.$wanlshop.msg("回执超时，請检查直播配置")}),1e4),uni.request({url:"".concat(t.$store.state.common.appUrl.api,"/wanlshop/live/startLive"),method:"POST",data:t.liveReady,header:{token:t.$store.state.user.token},success:function(e){0==e.data.code?uni.showToast({title:e.data.msg,icon:"none"}):(t.liveData=e.data.data,t.state=1,setTimeout((function(){t.context.start({success:function(t){}})}),100))}})):uni.showToast({title:"直播标题不能為空",icon:"none"}):uni.showToast({title:"直播封面不能為空",icon:"none"});case 3:case"end":return e.stop()}}),e)})))()},onLike:function(){1==this.state?(this.liveStatis.like+=1,uni.request({url:"".concat(this.$store.state.common.appUrl.api,"/wanlshop/live/like"),data:{id:this.liveData.id},header:{token:this.$store.state.user.token}})):uni.showToast({title:"直播还没有開始",icon:"none"})},switchCamera:function(){this.context.switchCamera()},numFormat:function(t){return t>9999?(t-t%1e3)/1e4+"万":t},statechange:function(e){t.log("statechange:"+JSON.stringify(e))},netstatus:function(e){t.log("netstatus:"+JSON.stringify(e))},error:function(e){t.log("error:"+JSON.stringify(e))},stop:function(){this.context.stop({success:function(e){t.log(JSON.stringify(e))}})}}};e.default=c}).call(this,i("5a52")["default"])},7888:function(t,e,i){"use strict";i.r(e);var o=i("63c3"),n=i.n(o);for(var a in o)"default"!==a&&function(t){i.d(e,t,(function(){return o[t]}))}(a);e["default"]=n.a},"95ab":function(t,e,i){var o=i("24fb");e=o(!1),e.push([t.i,".page[data-v-382e2c14]{position:absolute;left:0;right:0;top:0;bottom:0;background-color:#000}.wanl-live-ready[data-v-382e2c14]{position:fixed;left:0;right:0;top:0;bottom:0;padding-left:%?40?%;padding-right:%?40?%;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between}.wanl-live-ready-btn[data-v-382e2c14]{-webkit-box-align:center;-webkit-align-items:center;align-items:center}.wanl-live-ready-btn-bg[data-v-382e2c14]{background-color:#f72b36;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-border-radius:100px;border-radius:100px;height:%?92?%;width:%?500?%}.wanl-live-ready-btn-text[data-v-382e2c14]{color:#fff;font-size:%?32?%;font-weight:500}.wanl-live-ready-content[data-v-382e2c14]{background-color:rgba(0,0,0,.1);-webkit-border-radius:%?18?%;border-radius:%?18?%;padding:%?25?%;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;flex-direction:row}.wanl-live-ready-content-img[data-v-382e2c14]{position:relative;height:%?200?%;width:%?200?%;-webkit-border-radius:%?18?%;border-radius:%?18?%;background-color:#f7f7f7;overflow:hidden;margin-right:%?20?%}.wanl-live-ready-content-img-image[data-v-382e2c14]{height:%?200?%;width:%?200?%}.wanl-live-ready-content-tag[data-v-382e2c14]{position:absolute;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;background-color:rgba(0,0,0,.2);height:%?50?%;bottom:0;left:0;right:0}.wanl-live-ready-content-tag-text[data-v-382e2c14]{color:#fff;font-size:%?26?%}.wanl-live-ready-content-title[data-v-382e2c14]{-webkit-box-flex:1;-webkit-flex:1;flex:1}.wanl-live-ready-content-title-input[data-v-382e2c14]{-webkit-box-flex:1;-webkit-flex:1;flex:1;height:%?200?%;color:#fff;font-size:%?30?%}.wanl-live-footer[data-v-382e2c14]{position:absolute;left:0;right:0;bottom:0;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;flex-direction:row;padding-top:%?18?%;padding-bottom:%?18?%;padding-left:%?25?%;padding-right:%?25?%}\r\n/* POPUP */.wanl-live-popup[data-v-382e2c14]{background-color:#fff;-webkit-border-top-left-radius:%?18?%;border-top-left-radius:%?18?%;-webkit-border-top-right-radius:%?18?%;border-top-right-radius:%?18?%;overflow:hidden}.wanl-live-popup-title[data-v-382e2c14]{position:relative;-webkit-box-align:center;-webkit-align-items:center;align-items:center;margin-top:%?30?%;margin-bottom:%?40?%}.wanl-live-popup-title-text[data-v-382e2c14]{font-size:%?30?%;color:#333;font-weight:500}.wanl-live-popup-list[data-v-382e2c14]{padding-left:%?25?%;padding-right:%?25?%;height:%?800?%}.wanl-live-popup-list-item[data-v-382e2c14]{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;flex-direction:row;margin-bottom:%?25?%}.wanl-live-popup-list-item-img[data-v-382e2c14]{position:relative;width:%?180?%;height:%?180?%;-webkit-border-top-left-radius:%?12?%;border-top-left-radius:%?12?%;-webkit-border-top-right-radius:%?12?%;border-top-right-radius:%?12?%;-webkit-border-bottom-right-radius:%?12?%;border-bottom-right-radius:%?12?%;-webkit-border-bottom-left-radius:%?12?%;border-bottom-left-radius:%?12?%;overflow:hidden;background-color:#f7f7f7;margin-right:%?20?%}.wanl-live-popup-list-item-image[data-v-382e2c14]{width:%?180?%;height:%?180?%}.wanl-live-popup-list-item-img-tag[data-v-382e2c14]{position:absolute;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;top:0;left:0;background-color:rgba(50,50,50,.5);padding-left:%?14?%;padding-right:%?14?%;padding-top:%?2?%;padding-bottom:%?2?%;-webkit-border-bottom-right-radius:%?12?%;border-bottom-right-radius:%?12?%}.wanl-live-popup-list-item-img-tag-text[data-v-382e2c14]{color:#fff;font-size:%?24?%}.wanl-live-popup-list-item-subject[data-v-382e2c14]{-webkit-box-flex:1;-webkit-flex:1;flex:1;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between}.wanl-live-popup-list-item-subject-title-text[data-v-382e2c14]{color:#222;font-size:%?28?%;lines:2;text-overflow:ellipsis;\n}.wanl-live-popup-list-item-subject-operation[data-v-382e2c14]{-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;flex-direction:row}.wanl-live-popup-list-item-subject-operation-price-text[data-v-382e2c14]{color:#f72b36;font-size:%?32?%;font-weight:500}.wanl-live-popup-list-item-subject-operation-button[data-v-382e2c14]{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;flex-direction:row}.wanl-live-popup-list-item-subject-operation-button-shopping[data-v-382e2c14]{-webkit-border-radius:100px;border-radius:100px;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;align-items:center;width:%?36?%;height:%?36?%}.wanl-live-popup-list-item-subject-operation-button-shopping-img[data-v-382e2c14]{width:%?36?%;height:%?36?%}\r\n/* 商品 */.wanl-live-footer-bottom_goods[data-v-382e2c14]{position:relative;-webkit-box-flex:1;-webkit-flex:1;flex:1;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;align-items:center}.wanl-live-footer-bottom_goods-btn[data-v-382e2c14]{height:%?76?%;width:%?76?%}.wanl-live-footer-bottom_goods-tag[data-v-382e2c14]{position:absolute;top:%?-16?%;right:%?12?%;background-color:#f02b57;-webkit-border-radius:100px;border-radius:100px;padding-left:%?10?%;padding-right:%?10?%;padding-top:%?2?%;padding-bottom:%?2?%}.wanl-live-footer-bottom_goods-tag-text[data-v-382e2c14]{color:#fff;font-size:%?22?%}\r\n/* 点赞 */.wanl-live-footer-bottom_praise[data-v-382e2c14]{position:relative;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-flex:1;-webkit-flex:1;flex:1;margin-left:%?30?%}.wanl-live-footer-bottom_praise-btn[data-v-382e2c14]{height:%?76?%;width:%?76?%}.wanl-live-footer-bottom_praise-tag[data-v-382e2c14]{position:absolute;top:%?-16?%;left:%?12?%;background-color:#f02b57;-webkit-border-radius:100px;border-radius:100px;padding-left:%?6?%;padding-right:%?6?%;padding-top:%?2?%;padding-bottom:%?2?%}.wanl-live-footer-bottom_praise-tag-text[data-v-382e2c14]{color:#fff;font-size:%?22?%}.wanl-live-footer-left[data-v-382e2c14]{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;flex-direction:row}.wanl-live-footer-right[data-v-382e2c14]{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;flex-direction:row}\r\n/* 通用 */.wanl-live-footer-bottom[data-v-382e2c14]{background-color:rgba(0,0,0,.2);-webkit-border-radius:100px;border-radius:100px;overflow:hidden;width:%?76?%;height:%?76?%;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;align-items:center;margin-right:%?30?%}.wanl-live-footer-bottom-img[data-v-382e2c14]{width:%?76?%;height:%?76?%}",""]),t.exports=e},b3f6:function(t,e,i){"use strict";var o=i("5c80"),n=i.n(o);n.a},da79:function(t,e,i){"use strict";var o;i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return a})),i.d(e,"a",(function(){return o}));var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{staticClass:"page"})},a=[]}}]);